<%page expression_filter="h"/>
<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>
<%def name="online_help_token()"><% return "courseware" %></%def>
<%!
from django.utils.translation import ugettext as _
from django.conf import settings
from edxnotes.helpers import is_feature_enabled as is_edxnotes_enabled
from openedx.core.djangolib.markup import HTML
from openedx.core.djangolib.js_utils import js_escaped_string, dump_js_escaped_json
from openedx.core.djangoapps.site_configuration import helpers as configuration_helpers
from datetime import datetime, date
import json
%>
<link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
<style>
  .global-header, .wrapper-footer{
    display: none;
  }
  #certificate{
    background-image: url('${bg}');
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    width:auto;
    height: 100%;
    box-sizing: border-box;
    padding: 130px 100px 100px 100px;
    margin: 10px;
  }
  .container{
    margin-top:100px;
    width:1125px;
    height:700px;
    margin-left: auto;
    margin-right: auto;
    padding: 0;
    text-align: center;
  }
  .pdf{
    text-align: center;
    margin-top: 25px;
  }
  h2,h3,p,h1,h4{
    font-family: 'Raleway', sans-serif;
    margin-top: 15px!important;
  }
  p{
    font-size: 14px;
  }
  h3{
    font-size: 20px;
  }
  h2{
    font-size:35px;
    color: black;
  }
  h4{
    font-size: 16px;
  }
</style>

% if grades.get('passed'):
<div class="container">
  <div id="certificate">
    <div class="intro">
      <h3>Attestation de suivi et de réussite</h3>
    </div>
    <div class="main-text">
      % if last_name and first_name:
        <h1>${last_name} ${first_name}</h1>
      %else :
        <h1>${user.username}</h1>
      %endif
      <h4>a suivi et réussi le MOOC</h4>
      <h2>${course_name}</h2>
      <h4>avec un score de</h4>
      <h2>${grades.get('grade')*100}%</h2>
    </div>
    <div class="verification">
      <p>Code de vérification : ${hash} – A vérifier sur <a id="check_link" target="_blank" href="https://services.themoocagency.com/check?MOOC=${course_name}">https://services.themoocagency.com/check</a></p>
    </div>
  </div>
</div>
% else :
  <div class="container">
    <h4>Désolée vous n'avez pas atteint le score minimum pour débloquer votre certificat.</h4>
  </div>
% endif

% if grades.get('passed'):
<div class="pdf">
  <button id="pdf-btn" type="button" name="button">Version PDF</button>
</div>
%endif

<script
  src="https://code.jquery.com/jquery-2.2.4.min.js"
  integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
  crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.debug.js"></script>
<script type="text/javascript">
function printpage(){
   html2canvas(document.querySelector("#certificate"), {
    onrendered : function (canvas){
     var img=canvas.toDataURL("image/png");
     var doc = new jsPDF({orientation: 'landscape'});
     doc.addImage(img, "PNG", 0, 10);
     doc.save("certificat.pdf");
    }
  })
}

$('#pdf-btn').on('click', function(){
  printpage();
})
</script>



<%block name="pagetitle">${_("Certificat de reussite")}</%block>
